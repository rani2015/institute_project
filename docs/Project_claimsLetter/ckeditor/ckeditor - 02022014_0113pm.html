<!DOCTYPE html>
<html>
    <head>
        <title>Claims Template Designer</title>
        <!-- Make sure the path to CKEditor is correct. 
		C:\Users\jitesh\Desktop\PROJECT\GLI\ckeditor
		-->
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script language="JavaScript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
		<script language="JavaScript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.5.2/jquery-ui.min.js"></script>

        <script src="ckeditor.js"></script>
		<script src="adapters/jquery.js"></script>
		<style type="text/css" media="Screen">
			#schema {
			   margin-top:10px;
			   position:relative;
			   margin-top:10px;
			   width:200px;
			   background:white;
			   margin-left:10px;
			   vertical-align:top;
	 
			}
	 
			#contentwrapper {
			   width:300px;
			   height:0px;
			   background:white;
			   margin-top: 25px;
			   margin-left:250px;
			}
		</style>
	<script language="JavaScript">
		function toggleDiv(divid){
				var element=divid+"_child";
				obj=document.getElementById(element);
				col=document.getElementById(divid);
				if(obj.style.display == 'none'){
						document.getElementById(element).style.display = 'block';
						col.innerHTML="[-]";
			}else{
			  document.getElementById(element).style.display = 'none';
			  col.innerHTML="[+]";
			}
		  }
	</script>
 
			<style>

		div.editable
		{
			border: solid 2px transparent;
			padding-left: 15px;
			padding-right: 15px;
		}

		div.editable:hover
		{
			border-color: black;
		}

	</style>
	<script>

		// Uncomment the following code to test the "Timeout Loading Method".
		// CKEDITOR.loadFullCoreTimeout = 5;

		window.onload = function() {
			// Listen to the double click event.
			if ( window.addEventListener )
				document.body.addEventListener( 'dblclick', onDoubleClick, false );
			else if ( window.attachEvent )
				document.body.attachEvent( 'ondblclick', onDoubleClick );

		};

		function onDoubleClick( ev ) {
			// Get the element which fired the event. This is not necessarily the
			// element to which the event has been attached.
			var element = ev.target || ev.srcElement;

			// Find out the div that holds this element.
			var name;

			do {
				element = element.parentNode;
				//alert('name:'+name +"="+element.nodeName.toLowerCase()+ " " +element.className+" "+element.className.indexOf( 'editable' ));
			}while ( element && ( name = element.nodeName.toLowerCase() ) && ( element.className.indexOf( '_child_' ) == -1 ) && name != 'body' );
			
			//alert('name:'+name);
			//alert(name+' :'+ element.className);
		
			if ( name == 'div' && element.className.indexOf( '_child_' ) != -1 ){
				replaceDiv( element );
			}
		}

		var editor;

		function replaceDiv( div ) {
			//if ( editor )
			//editor.destroy();
			// alert("Replacing the contents:"+div.innerHTML);
			//editor = CKEDITOR.replace( div );
			//editor = CKEDITOR.appendTo( 'editor1',div);
			//editor = CKEDITOR.instances['editor1'];
			//editor.appendTo(div);
			editor = CKEDITOR.instances.editor1;
			
			editor.insertText( div.innerHTML.replace('<p>','').replace('</p>',''));
		}

		function InsertText() {
			// Get the editor instance that we want to interact with.
			var editor = CKEDITOR.instances.editor1;
			var value = document.getElementById( 'txtArea' ).value;

			// Check the active editing mode.
			if ( editor.mode == 'wysiwyg' )
			{
				// Insert as plain text.
				// http://docs.ckeditor.com/#!/api/CKEDITOR.editor-method-insertText
				editor.insertText( value );
			}
			else
				alert( 'You must be in WYSIWYG mode!' );
		}

	</script>
	
	</head>
    <body>
        <form>
			 <div id="headerContainer">
					<center><b>GLI Proof Of Concept - Claim Designer</b></center>
					<hr>
			</div>
			<div id="maincontainer">
				<div id="contentwrapper">
					<table>
					<tr>
						<td align="left"><h3>Template Name:</h3></td>
						<td align="left"><input type="text" width="900px" name="claimLetterName"></td>
						<td  align="right"><input type="submit" name="Save" value="Save"></td>
						<td  align="left"><input type="submit" name="Preview" value="Preview"></br></td>
					</tr>
					<tr>

						<td>&nbsp;&nbsp;</td>
						<td>&nbsp;&nbsp;</td>
					</tr>
					<tr>
						<td colspan="4">
							<textarea id="editor1" class="txtDropTarget" name="editor1">
								This is my textarea to be replaced with CKEditor.
							</textarea>
					</td>
					</tr>
					</table>

					
				</div>
				 <div id="schema">
                        
						<fieldset>
                        <legend>Click to insert:</legend>
                        <ul id="ClickWordList">
                          <li>Claim_No</li>
                          <li>Claim_Date</li>
                          <li>Claimant</li>
                        </ul>
                        </fieldset>
                        <fieldset>
                        <legend>Drag to insert:</legend>
                          <a href="javascript:;" onClick="toggleDiv('1')"><div id="1" style="margin-left: 0;display: inline;">[+]</div></a>
                          <strong>Claim Details</strong>
                        <ul id="DragWordList">
                          <div id="1_child" style="display:none">
                                  <li ><div class="1_child_1"><p>Claim_No</p></div></li>
                                  <li><div class="1_child_2"><p>Claim_Date</p></li>
                                  <li><div class="1_child_3"><p>Claimnt</p></li>
                          </div>
                        </ul>
                        </fieldset>
                </div>
			</div>
            <script>
                // Replace the <textarea id="editor1"> with a CKEditor
                // instance, using default configuration.

				CKEDITOR.replace( 'editor1');
            </script>

	<script language="JavaScript" type="text/javascript">
		$( document ).ready( function() {
			//$( 'textarea#editor1' ).ckeditor();
			
				$('#ClickWordList li').click(function() {
							$("#editor1").insertAtCaret($(this).text());
							return false
					});
			 $("#DragWordList li").draggable({helper: 'clone'});				
				
			$("#editor1").droppable({
					accept: '#DragWordList li',
					over: function( event, ui ) {
						ui['helper'][0]['txtDropTarget'] = this;
					},
					out: function( event, ui ) {
						delete ui['helper'][0]['txtDropTarget'];
					},
					drop: function( event, ui ) {   
						sdpFakeDrag(txtDropTarget,event,ui);
						//insert it now (I build an image from the dragged item)
					}
			});
			
		} );
		
		sdpFakeDrag = function(sdpParam,event,ui) {                
			alert('got into method');
			var editor = CKEDITOR.instances['editor1'];
			var target = $('.txtDropTarget').find('iframe')[0].contentDocument.elementFromPoint(event.layerX,event.layerY);                
			var range = new CKEDITOR.dom.range(editor.document);
			range.setStart(new CKEDITOR.dom.node(target), 0);
			range.collapse();
			editor.getSelection().selectRanges( [ range ] );        
			editor.focus();
		}

		$.fn.insertAtCaret = function (myValue) {
				return this.each(function(){
								//IE support
								if (document.selection) {
												this.focus();
												sel = document.selection.createRange();
												sel.text = myValue;
												this.focus();
								}
								//MOZILLA / NETSCAPE support
								else if (this.selectionStart || this.selectionStart == '0') {
												var startPos = this.selectionStart;
												var endPos = this.selectionEnd;
												var scrollTop = this.scrollTop;
												this.value = this.value.substring(0, startPos)+ myValue+ this.value.substring(endPos,this.value.length);
												this.focus();
												this.selectionStart = startPos + myValue.length;
												this.selectionEnd = startPos + myValue.length;
												this.scrollTop = scrollTop;
								} else {
												this.value += myValue;
												this.focus();
								}
				});
		};
	</script>

        </form>
    </body>
</html>